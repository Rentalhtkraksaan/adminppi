<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Database User - Mobile</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root {
            --bg: #000000;
            --card: #121212;
            --gold: #d4af37;
            --text: #ffffff;
            --red: #ff4d4d;
        }

        body { 
            font-family: 'Segoe UI', Roboto, sans-serif; 
            margin: 0; padding: 20px 15px 100px 15px; 
            background: var(--bg); color: var(--text);
        }

        .header { text-align: center; margin-bottom: 25px; }
        .total-box { font-size: 3rem; color: var(--gold); font-weight: bold; margin: 0; }
        .label { font-size: 0.7rem; letter-spacing: 2px; opacity: 0.6; }

        .user-card {
            background: var(--card); border: 1px solid #222;
            padding: 15px; border-radius: 16px; margin-bottom: 12px;
            display: flex; justify-content: space-between; align-items: center;
        }

        .user-info h3 { margin: 0; font-size: 0.95rem; color: var(--gold); }
        .user-info p { margin: 2px 0 0 0; font-size: 0.7rem; opacity: 0.5; }

        .activity-count {
            background: rgba(212, 175, 55, 0.1); color: var(--gold);
            padding: 4px 10px; border-radius: 10px; font-size: 0.65rem; font-weight: bold;
            border: 1px solid rgba(212, 175, 55, 0.3); margin-bottom: 8px; display: inline-block;
        }

        .btn-delete {
            background: rgba(255, 77, 77, 0.1); color: var(--red);
            border: 1px solid var(--red); padding: 8px 12px;
            border-radius: 8px; font-size: 0.7rem; font-weight: bold;
        }

        /* Bottom Nav */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; right: 0; height: 65px;
            background: #121212; display: flex; border-top: 1px solid #333;
            padding-bottom: env(safe-area-inset-bottom); z-index: 1000;
        }
        .nav-item {
            flex: 1; display: flex; flex-direction: column; align-items: center;
            justify-content: center; text-decoration: none; color: #555; font-size: 0.7rem;
        }
        .nav-item.active { color: var(--gold); font-weight: bold; }
        .nav-icon { font-size: 1.4rem; margin-bottom: 2px; }
    </style>
</head>
<body>

    <div class="header">
        <p class="label">TOTAL USER UNIK</p>
        <h1 id="total-count" class="total-box">0</h1>
    </div>

    <div id="user-list">
        </div>

    <nav class="bottom-nav">
        <a href="index.html" class="nav-item">
            <span class="nav-icon">ðŸ“‹</span>
            <span>Log Akses</span>
        </a>
        <a href="data.html" class="nav-item active">
            <span class="nav-icon">ðŸ‘¥</span>
            <span>Database</span>
        </a>
    </nav>

    <script>
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyDpPEkKbEt6b_v2OWlBfGuaVQpBg2-RWR4",
            databaseURL: "https://cwu-gen-2-default-rtdb.firebaseio.com",
        };
        firebase.initializeApp(FIREBASE_CONFIG);
        const db = firebase.database().ref('developer_clicks');

        db.on('value', (snapshot) => {
            const listContainer = document.getElementById('user-list');
            const countDisplay = document.getElementById('total-count');
            listContainer.innerHTML = '';

            if (snapshot.exists()) {
                const rawData = snapshot.val();
                const processedUsers = {};

                Object.keys(rawData).forEach(key => {
                    const item = rawData[key];
                    if (!item.nama) return;
                    const nameKey = item.nama.toLowerCase().trim();
                    if (!processedUsers[nameKey]) {
                        processedUsers[nameKey] = { nama: item.nama, count: 1 };
                    } else { processedUsers[nameKey].count += 1; }
                });

                const uniqueList = Object.values(processedUsers);
                countDisplay.innerText = uniqueList.length;

                uniqueList.forEach(user => {
                    listContainer.innerHTML += `
                        <div class="user-card">
                            <div class="user-info">
                                <h3>${user.nama}</h3>
                                <p>Terdeteksi Aktif</p>
                            </div>
                            <div style="text-align: right;">
                                <div class="activity-count">${user.count} Aktivitas</div><br>
                                <button class="btn-delete" onclick="hapusUser('${user.nama}')">HAPUS</button>
                            </div>
                        </div>
                    `;
                });
            }
        });

        function hapusUser(nama) {
            if (confirm(`Hapus permanen data ${nama}?`)) {
                db.orderByChild('nama').equalTo(nama).once('value', snapshot => {
                    if (snapshot.exists()) {
                        const updates = {};
                        snapshot.forEach(child => { updates[child.key] = null; });
                        db.update(updates);
                    }
                });
            }
        }
    </script>
</body>
</html>